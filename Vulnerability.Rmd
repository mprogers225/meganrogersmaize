---
title: "Vulnerability"
author: "Megan Patricia Rogers"
date: "6/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Package loading:
``` {r, warning=FALSE, message=FALSE}
library(tidyverse)  # suite of packages for data manipulation/visualization
library(Hmisc)  # more data analysis
library(plotrix)  # makes calculating standard error easier
library(dplyr)  # data frame manipulation
library(skimr)  # for creating summaries
library(magrittr)  # enable piping
```

#### Load data:
``` {r}
processed_projected_impact <- read.csv("processed_projected_impacts.csv", 
                                           header = TRUE, sep = ",", dec = ".")
```

#### Processing data:

```{r}
# Create new data frame with averages that you can compare

# USA
usa_yield_change <- processed_projected_impact %>%
  filter(country == "United States")
# use USA data frame to calculate mean change per C and per decade
usa_mean_change_per_C = mean(usa_yield_change$yield_change_per_C)
usa_se_per_C = std.error(usa_yield_change$yield_change_per_C)  # calculating standard error change per C

usa_mean_change_per_decade = mean(usa_yield_change$yield_change_per_decade)
usa_se_per_decade = std.error(usa_yield_change$yield_change_per_decade)  # calculating se change per decade


# Canada
canada_yield_change <- processed_projected_impact %>%
  filter(country == "Canada")
# use Canadian data frame to calculate mean change per C and per decade
canada_mean_change_per_C = mean(canada_yield_change$yield_change_per_C)
canada_se_per_C = std.error(canada_yield_change$yield_change_per_C)  # calculating standard error change per C

canada_mean_change_per_decade = mean(canada_yield_change$yield_change_per_decade)
canada_se_per_decade = std.error(canada_yield_change$yield_change_per_decade)  # calculating se change per decade

# creating new data frame with averages per country
vulnerability_by_country = data.frame(country = c("United States", "Canada"), 
                                      mean_change_per_C = c(usa_mean_change_per_C, 
                                                            canada_mean_change_per_C),
                                      mean_change_per_decade = c(usa_mean_change_per_decade, 
                                                                 canada_mean_change_per_decade),
                                      se_per_c = c(usa_se_per_C, canada_se_per_C),
                                      se_per_decade = c(usa_se_per_decade, canada_se_per_decade))


```

#### Graph generation:

```{r}

# mean change per C
ggplot(data=vulnerability_by_country, aes(x=country, y=mean_change_per_C, 
                          color=country)) +
  geom_bar(stat = "identity") + 
  geom_errorbar(aes(ymin = mean_change_per_C - se_per_c, 
                    ymax = mean_change_per_C + se_per_c), width = .6) +
  labs(title="Projected Climate Change-Attributed Yield Changes Per Rise in ˚C", 
       x="Country", 
       y="Projected Yield Change per 1 ˚C Rise in Temperature (%C^(-1))")

# mean change per decade
ggplot(data=vulnerability_by_country, aes(x=country, y=mean_change_per_decade, 
                          color=country)) +
  geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = mean_change_per_decade - se_per_decade, 
                    ymax = mean_change_per_decade + se_per_decade), width = .6) +
  labs(title="Projected Climate Change-Attributed Yield Changes Per Decade", 
       x="Country", 
       y="Projected Yield Change per Decade (%10yr^(-1))")
```












#### Exploring statistical significance:
##### Visually checking for normality in data:
``` {r}

hist(canada_yield_change$yield_change_per_C, 
     main = "Histogram of estimated yield change per C Canada",
     xlab = "Estimated percent yield change for 1 ˚C rise")

hist(usa_yield_change$yield_change_per_C,
     main = "Histogram of estimated yield change per C USA",
     xlab = "Estimated percent yield change for 1 ˚C rise")

hist(canada_yield_change$yield_change_per_decade,
     main = "Histogram of estimated yield change per decade Canada",
     xlab = "Estimated percient yield change per decade")

hist(usa_yield_change$yield_change_per_decade,
     main = "Histogram of estimated yield change per decade USA",
     xlab = "Estimated percient yield change per decade")

```

Distribution is far from perfect but is roughly bell-shaped. Given that N ≥ 20
for both Canada and USA data frames, a 2 sample unpaired T-test is still an acceptable
test to perform between the two data sets to test for statistical significance 
Source: [LINK] https://www.statisticshowto.com/probability-and-statistics/non-normal-distributions/

##### Using 2 Sample Unpaired T-test to evaluate significance
``` {r}

t.test(canada_yield_change$yield_change_per_C, 
       usa_yield_change$yield_change_per_C, 
       paired=FALSE)  # generates p value of p=.0009865

t.test(canada_yield_change$yield_change_per_decade, 
       usa_yield_change$yield_change_per_decade, 
       paired=FALSE)  # p-value = 0.0011

```





